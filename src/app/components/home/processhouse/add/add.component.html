<form [formGroup]="qualityForm" (ngSubmit)="onSubmit()" class="px-[3%] py-3 md:py-5">
  <div class="bg-white w-full rounded-3xl shadow p-[2%]">
    <div class="flex justify-between h-12 space-y-3">
      <h1 class="text-[--blue-text] text-lg font-bold">Create Process House</h1>
    </div>
    <!-- Upper section: Main Details & Tax Details side by side on desktop, stacked on mobile -->
    <div class="flex flex-col md:flex-row gap-10">
      <!-- Main Details -->
      <div class="flex-1 space-y-3">
        <h1 class="text-[--blue-text] text-lg font-bold">Main Details</h1>
        <div class="w-full">
          <span class="py-2">Name <span class="text-red-500">*</span></span>
          <input 
            formControlName="name" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('name')?.invalid && qualityForm.get('name')?.touched"
            [class.border-2]="qualityForm.get('name')?.invalid && qualityForm.get('name')?.touched"
            type="text" 
            id="name"
            autofocus>
          <div *ngIf="qualityForm.get('name')?.invalid && qualityForm.get('name')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('name')?.errors?.['required']">Name is required</span>
            <span *ngIf="qualityForm.get('name')?.errors?.['minlength']">Name must be at least 2 characters</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">Remarks</span>
          <input formControlName="remarks" class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" type="text" id="remarks">
        </div>
      </div>
      <!-- Tax Details -->
      <div class="flex-1 space-y-3">
        <h1 class="text-[--blue-text] text-lg font-bold">Tax Details</h1>
        <div class="w-full">
          <span class="py-2">GST State <span class="text-red-500">*</span></span>
          <select 
            formControlName="gstState" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('gstState')?.invalid && qualityForm.get('gstState')?.touched"
            [class.border-2]="qualityForm.get('gstState')?.invalid && qualityForm.get('gstState')?.touched"
            id="gstState"
          >
            <option disabled value="">Select state</option>
            <option *ngFor="let state of states" [value]="state">{{ state }}</option>
          </select>
          <div *ngIf="qualityForm.get('gstState')?.invalid && qualityForm.get('gstState')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('gstState')?.errors?.['required']">GST State is required</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">Pan Number <span class="text-red-500">*</span></span>
          <input 
            formControlName="panNo" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('panNo')?.invalid && qualityForm.get('panNo')?.touched"
            [class.border-2]="qualityForm.get('panNo')?.invalid && qualityForm.get('panNo')?.touched"
            type="text" 
            id="panNo">
          <div *ngIf="qualityForm.get('panNo')?.invalid && qualityForm.get('panNo')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('panNo')?.errors?.['required']">PAN number is required</span>
            <span *ngIf="qualityForm.get('panNo')?.errors?.['pattern']">Please enter a valid PAN format (e.g., ABCDE1234F)</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">GST Number <span class="text-red-500">*</span></span>
          <input 
            formControlName="gstNo" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('gstNo')?.invalid && qualityForm.get('gstNo')?.touched"
            [class.border-2]="qualityForm.get('gstNo')?.invalid && qualityForm.get('gstNo')?.touched"
            type="text" 
            id="gstNo">
          <div *ngIf="qualityForm.get('gstNo')?.invalid && qualityForm.get('gstNo')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('gstNo')?.errors?.['required']">GST number is required</span>
            <span *ngIf="qualityForm.get('gstNo')?.errors?.['pattern']">Please enter a valid GST format</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Party Details section below -->
    <div class="mt-8">
      <h1 class="text-[--blue-text] text-lg font-bold mb-4">Party Details</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="w-full">
          <span class="py-2">Address <span class="text-red-500">*</span></span>
          <input 
            formControlName="address" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('address')?.invalid && qualityForm.get('address')?.touched"
            [class.border-2]="qualityForm.get('address')?.invalid && qualityForm.get('address')?.touched"
            type="text" 
            id="address">
          <div *ngIf="qualityForm.get('address')?.invalid && qualityForm.get('address')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('address')?.errors?.['required']">Address is required</span>
            <span *ngIf="qualityForm.get('address')?.errors?.['minlength']">Address must be at least 10 characters</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">Cover Address</span>
          <input formControlName="coverAddress" class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" type="text" id="coverAddress">
        </div>
        <div class="w-full">
          <span class="py-2">State <span class="text-red-500">*</span></span>
          <select 
            formControlName="state" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('state')?.invalid && qualityForm.get('state')?.touched"
            [class.border-2]="qualityForm.get('state')?.invalid && qualityForm.get('state')?.touched"
            id="state"
          >
            <option disabled value="">Select state</option>
            <option *ngFor="let state of states" [value]="state">{{ state }}</option>
          </select>
          <div *ngIf="qualityForm.get('state')?.invalid && qualityForm.get('state')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('state')?.errors?.['required']">State is required</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">District <span class="text-red-500">*</span></span>
          <input 
            formControlName="district" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('district')?.invalid && qualityForm.get('district')?.touched"
            [class.border-2]="qualityForm.get('district')?.invalid && qualityForm.get('district')?.touched"
            type="text" 
            id="district">
          <div *ngIf="qualityForm.get('district')?.invalid && qualityForm.get('district')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('district')?.errors?.['required']">District is required</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">City <span class="text-red-500">*</span></span>
          <input 
            formControlName="city" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('city')?.invalid && qualityForm.get('city')?.touched"
            [class.border-2]="qualityForm.get('city')?.invalid && qualityForm.get('city')?.touched"
            type="text" 
            id="city">
          <div *ngIf="qualityForm.get('city')?.invalid && qualityForm.get('city')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('city')?.errors?.['required']">City is required</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">Pin Code <span class="text-red-500">*</span></span>
          <input 
            formControlName="pinCode" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('pinCode')?.invalid && qualityForm.get('pinCode')?.touched"
            [class.border-2]="qualityForm.get('pinCode')?.invalid && qualityForm.get('pinCode')?.touched"
            type="number" 
            id="pinCode">
          <div *ngIf="qualityForm.get('pinCode')?.invalid && qualityForm.get('pinCode')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('pinCode')?.errors?.['required']">PIN code is required</span>
            <span *ngIf="qualityForm.get('pinCode')?.errors?.['pattern']">Please enter a valid 6-digit PIN code</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">Phone (O)</span>
          <input formControlName="phoneNoOffice" class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" type="number" id="phoneNoOffice">
        </div>
        <div class="w-full">
          <span class="py-2">Phone (R)</span>
          <input formControlName="phoneNoResidant" class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" type="number" id="phoneNoResidant">
        </div>
        <div class="w-full">
          <span class="py-2">Mobile <span class="text-red-500">*</span></span>
          <input 
            formControlName="mobileNo" 
            class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]"
            [class.border-red-500]="qualityForm.get('mobileNo')?.invalid && qualityForm.get('mobileNo')?.touched"
            [class.border-2]="qualityForm.get('mobileNo')?.invalid && qualityForm.get('mobileNo')?.touched"
            type="number" 
            id="mobileNo">
          <div *ngIf="qualityForm.get('mobileNo')?.invalid && qualityForm.get('mobileNo')?.touched" class="text-red-500 text-sm mt-1">
            <span *ngIf="qualityForm.get('mobileNo')?.errors?.['required']">Mobile number is required</span>
            <span *ngIf="qualityForm.get('mobileNo')?.errors?.['pattern']">Please enter a valid 10-digit mobile number</span>
          </div>
        </div>
        <div class="w-full">
          <span class="py-2">Fax</span>
          <input formControlName="fax" class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" type="number" id="fax">
        </div>
        <div class="w-full">
          <span class="py-2">Email</span>
          <input formControlName="email" class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" type="text" id="email">
        </div>
      </div>
    </div>

    <!-- Process Longing Section (moved to bottom) -->
    <div class="mt-8">
      <h1 class="text-[--blue-text] text-lg font-bold mb-4">Process Longing</h1>
      <div class="flex justify-between items-center mb-4">
        <button 
          type="button" 
          (click)="openLongingModal()" 
          class="bg-[--primary] hover:bg-black hover:text-white font-medium py-2 px-4 rounded-md focus:outline-none focus:shadow-outline flex items-center"
        >
          <span class="mr-1">+</span> Add Longing
        </button>
      </div>
      <div *ngIf="longings.length > 0" class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-100">
            <tr>
              <th class="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Cloth Quality</th>
              <th class="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Longition</th>
              <th class="py-2 px-4 border-b text-center text-sm font-medium text-gray-700">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let longing of longings; let i = index" class="hover:bg-gray-50">
              <td class="py-2 px-4 border-b">{{ longing.clothQuality }}</td>
              <td class="py-2 px-4 border-b">{{ longing.longition }}</td>
              <td class="py-2 px-4 border-b text-center">
                <button 
                  type="button" 
                  (click)="editLonging(i)" 
                  class="text-blue-600 hover:text-blue-800 mr-2"
                >
                  Edit
                </button>
                <button 
                  type="button" 
                  (click)="deleteLonging(i)" 
                  class="text-red-600 hover:text-red-800"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="longings.length === 0" class="text-center py-4 text-gray-500">
        No process longings added yet.
      </div>
    </div>

    <div class="flex justify-end gap-2 mt-8">
      <button type="button" class="h-14 w-36 text-[--primary] border-[--primary] border hover:text-white hover:bg-black font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline" [routerLink]="['/processhouse']">
        Cancel
      </button>
      <button type="submit" class="h-14 w-36 bg-[--primary] hover:bg-black text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline" [disabled]="qualityForm.invalid">
        Submit
      </button>
    </div>
  </div>
</form>

<!-- Process Longing Modal -->
<div *ngIf="showLongingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 animate-fadeIn">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-[--blue-text]">
        {{ editingIndex >= 0 ? 'Edit Process Longing' : 'Add Process Longing' }}
      </h3>
      <button 
        type="button" 
        (click)="closeLongingModal()" 
        class="text-gray-500 hover:text-gray-700"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <form [formGroup]="longingForm" (ngSubmit)="submitLongingForm()" class="space-y-4">
      <div>
        <label for="modalClothQuality" class="block text-sm font-medium mb-1">Cloth Quality <span class="text-red-500">*</span></label>
        <select 
          formControlName="clothQuality" 
          class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" 
          id="modalClothQuality"
        >
          <option disabled value="">Select cloth quality</option>
          <option *ngFor="let process of processLonging" [value]="process">{{ process }}</option>
        </select>
        <div *ngIf="longingForm.get('clothQuality')?.invalid && longingForm.get('clothQuality')?.touched" class="text-red-500 text-sm mt-1">
          Cloth Quality is required.
        </div>
      </div>
      
      <div>
        <label for="modalLongition" class="block text-sm font-medium mb-1">Longition <span class="text-red-500">*</span></label>
        <input 
          formControlName="longition" 
          class="bg-[--input] h-[50px] w-full rounded-lg p-2 outline-none focus:ring-1 focus:ring-[--primary]" 
          type="number" 
          id="modalLongition"
        >
        <div *ngIf="longingForm.get('longition')?.invalid && longingForm.get('longition')?.touched" class="text-red-500 text-sm mt-1">
          Longition is required.
        </div>
      </div>
      
      <div class="flex justify-end gap-3 pt-4">
        <button 
          type="button" 
          (click)="closeLongingModal()" 
          class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
        >
          Cancel
        </button>
        <button 
          type="submit" 
          class="px-4 py-2 bg-[--primary] text-white rounded-md hover:bg-black"
          [disabled]="longingForm.invalid"
        >
          {{ editingIndex >= 0 ? 'Update' : 'Add' }}
        </button>
      </div>
    </form>
  </div>
</div>
